<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Freelynk - My Account</title>
  <link rel="stylesheet" href="../styles/account.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="module" src="../pages/firebaseauth.js"></script>
</head>
<body>
  <!-- <header>
    <nav>
      <a href="Freelancing.html" class="nav-link">Home</a>
      <a href="Freelancing.html#services" class="nav-link">Services</a>
      <a href="Freelancing.html#contact" class="nav-link">Contact</a>
      <a href="account.html" class="nav-link">About</a>
    </nav>
    <section class="hero">
      <img src="../assets/newFreelynkLogo.png" alt="FreeLynk Logo" class="logo" />
    </section>
  </header> -->

  <main>
    <section id="dashboard" class="account-section">
      <h2>Welcome, <span id="user-name">Client</span></h2>

      <button id="logout-btn">Logout</button>

      <section class="account-actions">
        <h3>Account Options</h3>
        <ul>
          <li><a href="#">Manage Profile</a></li>
          <li><a href="#">Post a New Project</a></li>
          <li><a href="detailed_milestone.html">View All Projects</a></li>
        </ul>
      </section>

      <!-- <section class="pending-projects">
        <h3>Projects Awaiting Approval</h3>
        <ul id="pending-projects-list">
        </ul>
      </section> -->
    </section>
  </main>

  <!-- <footer class="site-footer">
    <section class="footer-branding">
      <h2 class="footer-logo">FREELYNK</h2>
      <p class="tagline">Link. Work. Grow.</p>
      <section class="social-icons">
        <a href="#"><img src="https://img.icons8.com/ios-filled/24/ffffff/facebook.png" alt="Facebook" /></a>
        <a href="#"><img src="https://img.icons8.com/ios-filled/24/ffffff/instagram-new.png" alt="Instagram" /></a>
        <a href="#"><img src="https://img.icons8.com/ios-filled/24/ffffff/twitterx.png" alt="X" /></a>
      </section>
    </section>
  </footer> -->

  <script type="module">
    import { auth, logoutUser } from "../pages/firebaseauth.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

    const db = getFirestore();

    const userNameSpan = document.getElementById("user-name");
    const projectsList = document.getElementById("pending-projects-list");
    const logoutBtn = document.getElementById("logout-btn");

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        userNameSpan.textContent = user.displayName || user.email;

        // Load pending projects for the current user
        const q = query(collection(db, "projects"), where("clientId", "==", user.uid), where("status", "==", "pending"));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          projectsList.innerHTML = "<li>No pending projects.</li>";
        } else {
          querySnapshot.forEach((doc) => {
            const project = doc.data();
            const li = document.createElement("li");
            li.textContent = `${project.title} â€“ Waiting for freelancer approval`;
            projectsList.appendChild(li);
          });
        }
      } else {
        // Not logged in
        window.location.href = "login.html";
      }
    });

    logoutBtn.addEventListener("click", async () => {
      await logoutUser();
      window.location.href = "index.html";
    });
  </script>
</body>
</html>
